<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FPS Game Full</title>
<style>
  body { margin: 0; overflow: hidden; background: #000; }
  #score {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 24px;
    font-family: Arial;
  }
  #fireBtn {
    position: fixed;
    bottom: 80px;
    right: 30px;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255,0,0,0.8);
    color: white;
    font-size: 18px;
    border: none;
    z-index: 10;
  }
  #joystick {
    position: fixed;
    bottom: 40px;
    left: 40px;
    width: 120px;
    height: 120px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    touch-action: none;
    z-index: 10;
  }
  #stick {
    position: absolute;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.4);
    border-radius: 50%;
    top: 30px;
    left: 30px;
  }
  /* Crosshair */
  #crosshair {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin-left: -10px;
    margin-top: -10px;
    z-index: 20;
  }
  #crosshair div {
    position: absolute;
    background: white;
  }
  #crosshair .horiz {
    top: 9px;
    left: 0;
    width: 20px;
    height: 2px;
  }
  #crosshair .vert {
    left: 9px;
    top: 0;
    width: 2px;
    height: 20px;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<button id="fireBtn">FIRE</button>
<div id="joystick"><div id="stick"></div></div>
<div id="crosshair">
  <div class="horiz"></div>
  <div class="vert"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
// Scene
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xa0d8f0);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 2, 5);

// Renderer
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10, 20, 10);
scene.add(light);

// Ground
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500, 500),
  new THREE.MeshPhongMaterial({ color: 0x228B22 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// Moving targets (bots)
const targets = [];
function createTarget(x, z) {
  const target = new THREE.Mesh(
    new THREE.BoxGeometry(2, 2, 2),
    new THREE.MeshPhongMaterial({ color: 0xff0000 })
  );
  target.position.set(x, 1, z);
  scene.add(target);
  targets.push({ mesh: target, speed: 0.02 });
}
createTarget(0, -15);
createTarget(10, -20);
createTarget(-10, -25);

// Gun model
const gunGeometry = new THREE.BoxGeometry(0.2, 0.2, 1);
const gunMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
const gun = new THREE.Mesh(gunGeometry, gunMaterial);
scene.add(gun);

// Muzzle flash
const flashGeometry = new THREE.SphereGeometry(0.2, 16, 16);
const flashMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
const muzzleFlash = new THREE.Mesh(flashGeometry, flashMaterial);
muzzleFlash.visible = false;
scene.add(muzzleFlash);

// Movement variables
const move = { forward: false, backward: false, left: false, right: false };
const speed = 20;
let joystickDir = { x: 0, y: 0 };

document.addEventListener('keydown', (e) => {
  if (e.code === 'KeyW') move.forward = true;
  if (e.code === 'KeyS') move.backward = true;
  if (e.code === 'KeyA') move.left = true;
  if (e.code === 'KeyD') move.right = true;
});
document.addEventListener('keyup', (e) => {
  if (e.code === 'KeyW') move.forward = false;
  if (e.code === 'KeyS') move.backward = false;
  if (e.code === 'KeyA') move.left = false;
  if (e.code === 'KeyD') move.right = false;
});

// Camera look
let isDragging = false, prevX = 0, prevY = 0;
document.addEventListener('mousedown', (e) => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
document.addEventListener('mouseup', () => { isDragging = false; });
document.addEventListener('mousemove', (e) => {
  if (isDragging) {
    rotateCamera(e.clientX, e.clientY);
    prevX = e.clientX;
    prevY = e.clientY;
  }
});
document.addEventListener('touchstart', (e) => {
  if (e.touches.length === 1) {
    prevX = e.touches[0].clientX;
    prevY = e.touches[0].clientY;
  }
});
document.addEventListener('touchmove', (e) => {
  if (e.touches.length === 1) {
    rotateCamera(e.touches[0].clientX, e.touches[0].clientY);
    prevX = e.touches[0].clientX;
    prevY = e.touches[0].clientY;
  }
});

function rotateCamera(newX, newY) {
  const deltaX = newX - prevX;
  const deltaY = newY - prevY;
  camera.rotation.y += deltaX * 0.002;
  camera.rotation.x -= deltaY * 0.002;
  camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
}

// Shooting
let score = 0;
const scoreEl = document.getElementById('score');
document.getElementById('fireBtn').addEventListener('click', shoot);
document.addEventListener('click', shoot);

function shoot() {
  const raycaster = new THREE.Raycaster();
  const dir = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion);
  raycaster.set(camera.position, dir);
  const hits = raycaster.intersectObjects(targets.map(t => t.mesh));
  if (hits.length > 0) {
    hits[0].object.material.color.set(0x00ff00);
    score += 10;
    scoreEl.textContent = "Score: " + score;
  }
  showMuzzleFlash();
}

function showMuzzleFlash() {
  muzzleFlash.position.copy(gun.position).add(new THREE.Vector3(0, 0, -0.7).applyQuaternion(camera.quaternion));
  muzzleFlash.visible = true;
  setTimeout(() => muzzleFlash.visible = false, 100);
}

// Joystick
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');
let centerX = joystick.offsetWidth / 2;
let centerY = joystick.offsetHeight / 2;

joystick.addEventListener('touchstart', (e) => moveStick(e.touches[0].clientX, e.touches[0].clientY));
joystick.addEventListener('touchmove', (e) => moveStick(e.touches[0].clientX, e.touches[0].clientY));
joystick.addEventListener('touchend', () => {
  stick.style.top = '30px';
  stick.style.left = '30px';
  joystickDir = { x: 0, y: 0 };
});

function moveStick(x, y) {
  const rect = joystick.getBoundingClientRect();
  const dx = x - rect.left - centerX;
  const dy = y - rect.top - centerY;
  const distance = Math.min(Math.sqrt(dx*dx + dy*dy), centerX - 10);
  const angle = Math.atan2(dy, dx);
  const newX = centerX + distance * Math.cos(angle) - stick.offsetWidth / 2;
  const newY = centerY + distance * Math.sin(angle) - stick.offsetHeight / 2;
  stick.style.left = newX + 'px';
  stick.style.top = newY + 'px';
  joystickDir = { x: Math.cos(angle) * (distance / (centerX - 10)), y: Math.sin(angle) * (distance / (centerY - 10)) };
}

// Animate
let prevTime = performance.now();
function animate() {
  requestAnimationFrame(animate);
  const time = performance.now();
  const delta = (time - prevTime) / 1000;

  const direction = new THREE.Vector3();
  if (move.forward) direction.z = -1;
  if (move.backward) direction.z = 1;
  if (move.left) direction.x = -1;
  if (move.right) direction.x = 1;

  direction.x += joystickDir.x;
  direction.z -= joystickDir.y;
  if (direction.length() > 0) direction.normalize();

  const moveX = direction.x * speed * delta;
  const moveZ = direction.z * speed * delta;

  const forward = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion);
  const right = new THREE.Vector3(1, 0, 0).applyQuaternion(camera.quaternion);

  camera.position.addScaledVector(forward, moveZ);
  camera.position.addScaledVector(right, moveX);

  // Gun follows camera
  gun.position.copy(camera.position).add(new THREE.Vector3(0.3, -0.3, -0.8).applyQuaternion(camera.quaternion));
  gun.quaternion.copy(camera.quaternion);

  // Move targets (bots)
  targets.forEach(t => {
    t.mesh.position.x += Math.sin(time * 0.001 * t.speed * 100);
  });

  prevTime = time;
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
