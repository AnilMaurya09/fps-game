<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free Fire Style FPS with Island</title>
<style>
    body { margin: 0; overflow: hidden; background: #000; font-family: Arial; touch-action: none; }
    canvas { display: block; }
    #hud {
        position: fixed; top: 10px; left: 10px; color: white; z-index: 20; font-size: 18px;
    }
    #ammo, #timer, #score, #weapon { margin-bottom: 5px; }
    #healthBar { width: 200px; height: 20px; background: #333; border-radius: 5px; overflow: hidden; margin-top: 5px; }
    #health { width: 100%; height: 100%; background: #0f0; transition: width 0.2s; }
    #fireBtn, #reloadBtn, .weaponBtn, #zoomBtn {
        position: fixed; bottom: 80px; width: 80px; height: 80px; border-radius: 50%; color: white; font-size: 16px; border: none; z-index: 10;
    }
    #fireBtn { right: 30px; background: rgba(255,0,0,0.8); }
    #reloadBtn { right: 130px; background: rgba(0,0,255,0.8); }
    .weaponBtn {
        width: 60px; height: 60px; border-radius: 10px; bottom: 180px; font-size: 12px;
    }
    #rifleBtn { right: 30px; }
    #sniperBtn { right: 100px; }
    #shotgunBtn { right: 170px; }
    #zoomBtn { bottom: 280px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.3); font-size: 14px; }
    #joystick {
        position: fixed; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; z-index: 10;
    }
    #stick { position: absolute; width: 60px; height: 60px; background: rgba(255,255,255,0.4); border-radius: 50%; top: 30px; left: 30px; }
    #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; margin-left: -10px; margin-top: -10px; z-index: 20; }
    #crosshair div { position: absolute; background: white; }
    #crosshair .horiz { top: 9px; left: 0; width: 20px; height: 2px; }
    #crosshair .vert { left: 9px; top: 0; width: 2px; height: 20px; }
    #scopeOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
        background-image: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.8) 32%); z-index: 25; }
    #hitFlash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.3); display: none; z-index: 30; }
    #gameOver { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 36px; display: none; text-align: center; z-index: 40; }
    #restartBtn { margin-top: 20px; padding: 10px 20px; font-size: 18px; background: #0f0; border: none; border-radius: 10px; cursor: pointer; }
</style>
</head>
<body>
<div id="hud">
    <div id="weapon">Weapon: Rifle</div>
    <div id="ammo">Ammo: 30 / 90</div>
    <div id="timer">Time: 60</div>
    <div id="score">Score: 0</div>
    <div id="healthBar"><div id="health"></div></div>
</div>
<button id="fireBtn">FIRE</button>
<button id="reloadBtn">RLD</button>
<button class="weaponBtn" id="rifleBtn">Rifle</button>
<button class="weaponBtn" id="sniperBtn">Sniper</button>
<button class="weaponBtn" id="shotgunBtn">Shotgun</button>
<button id="zoomBtn">Zoom</button>
<div id="joystick"><div id="stick"></div></div>
<div id="crosshair"><div class="horiz"></div><div class="vert"></div></div>
<div id="scopeOverlay"></div>
<div id="hitFlash"></div>
<div id="gameOver">GAME OVER<br><button id="restartBtn">Restart</button></div>

<!-- Three.js & Helpers -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/objects/Water2.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/objects/Reflector.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/objects/Refractor.js"></script>

<script>
/* CONFIG */
const weapons = {
    Rifle: { ammo:30, reserve:90, fireRate:0.1, reloadTime:1.5, recoil:0.01, sound:"https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b8c91fa2d.mp3", zoom:false },
    Sniper: { ammo:5, reserve:20, fireRate:1.5, reloadTime:2.5, recoil:0.03, sound:"https://cdn.pixabay.com/download/audio/2022/03/15/audio_5a335ea78d.mp3", zoom:true },
    Shotgun: { ammo:8, reserve:24, fireRate:1.0, reloadTime:2.0, recoil:0.02, sound:"https://cdn.pixabay.com/download/audio/2022/03/15/audio_041d88b1f8.mp3", zoom:false }
};
let currentWeapon="Rifle",ammo=weapons[currentWeapon].ammo,reserve=weapons[currentWeapon].reserve;
let fireCooldown=0,isZoomed=false,score=0,health=100,timeLeft=60,gameOver=false,enemies=[];

/* SCENE */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,3,10);
const renderer=new THREE.WebGLRenderer();renderer.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(renderer.domElement);

/* LIGHT */
const hemiLight=new THREE.HemisphereLight(0xffffff,0x444444,1.2);scene.add(hemiLight);
const dirLight=new THREE.DirectionalLight(0xffffff,1);dirLight.position.set(10,20,10);scene.add(dirLight);

/* SKY */
const skyTexture=new THREE.TextureLoader().load("https://threejs.org/examples/textures/2294472375_24a3b8ef46_o.jpg");
scene.background=skyTexture;

/* WATER */
const waterGeometry=new THREE.PlaneGeometry(500,500);
const water=new THREE.Water(waterGeometry,{color:0x001e0f,scale:4,flowDirection:new THREE.Vector2(1,1),textureWidth:512,textureHeight:512});
water.rotation.x=-Math.PI/2;scene.add(water);

/* ISLAND MODEL */
const loader=new THREE.GLTFLoader();
loader.load("https://rawcdn.githack.com/KhronosGroup/glTF-Sample-Models/master/2.0/Terrain/glTF/Terrain.gltf",gltf=>{
    const island=gltf.scene;island.scale.set(5,5,5);island.position.set(0,0,0);scene.add(island);
});

/* ENEMIES */
function spawnEnemy(){const enemy=new THREE.Mesh(new THREE.BoxGeometry(1,2,1),new THREE.MeshPhongMaterial({color:0xff0000}));enemy.position.set((Math.random()*20)-10,1,-(10+Math.random()*30));enemy.health=100;scene.add(enemy);enemies.push(enemy);}for(let i=0;i<3;i++)spawnEnemy();

/* GUN HOLDER */
const gunGroup=new THREE.Group();scene.add(gunGroup);
function updateGunModel(){gunGroup.clear();const gun=new THREE.Mesh(new THREE.BoxGeometry(0.2,0.2,1),new THREE.MeshStandardMaterial({color:0x333333}));gun.position.z=-0.5;gunGroup.add(gun);}updateGunModel();

/* HUD */
const ammoEl=document.getElementById("ammo"),timerEl=document.getElementById("timer"),healthEl=document.getElementById("health"),scoreEl=document.getElementById("score"),weaponEl=document.getElementById("weapon"),scopeOverlay=document.getElementById("scopeOverlay");
function updateHUD(){ammoEl.textContent=`Ammo: ${ammo} / ${reserve}`;timerEl.textContent=`Time: ${timeLeft}`;scoreEl.textContent=`Score: ${score}`;weaponEl.textContent=`Weapon: ${currentWeapon}`;healthEl.style.width=health+"%";}

/* AIM CONTROL */
let move={forward:false,backward:false,left:false,right:false};
document.addEventListener('keydown',e=>{if(e.code==="KeyW")move.forward=true;if(e.code==="KeyS")move.backward=true;if(e.code==="KeyA")move.left=true;if(e.code==="KeyD")move.right=true;});
document.addEventListener('keyup',e=>{if(e.code==="KeyW")move.forward=false;if(e.code==="KeyS")move.backward=false;if(e.code==="KeyA")move.left=false;if(e.code==="KeyD")move.right=false;});
renderer.domElement.addEventListener('click',()=>{if(document.pointerLockElement!==renderer.domElement)renderer.domElement.requestPointerLock();});
document.addEventListener('mousemove',e=>{if(document.pointerLockElement===renderer.domElement){targetRotY-=e.movementX*0.002;targetRotX-=e.movementY*0.002;}});

let targetRotX=0,targetRotY=0;

/* FIRE */
function fire(){if(gameOver||fireCooldown>0||ammo<=0)return;ammo--;fireCooldown=weapons[currentWeapon].fireRate;updateHUD();new Audio(weapons[currentWeapon].sound).play();camera.rotation.x-=weapons[currentWeapon].recoil;const raycaster=new THREE.Raycaster();const dir=new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);raycaster.set(camera.position,dir);const hits=raycaster.intersectObjects(enemies);if(hits.length>0){const enemy=hits[0].object;enemy.health-=25;if(enemy.health<=0){scene.remove(enemy);enemies=enemies.filter(e=>e!==enemy);spawnEnemy();score+=10;}}}
document.getElementById("fireBtn").onclick=fire;
document.getElementById("reloadBtn").onclick=()=>{if(ammo<weapons[currentWeapon].ammo&&reserve>0){setTimeout(()=>{let need=weapons[currentWeapon].ammo-ammo;let load=Math.min(need,reserve);ammo+=load;reserve-=load;updateHUD();},1500);}};
document.getElementById("zoomBtn").onclick=()=>{if(currentWeapon==="Sniper"){isZoomed=!isZoomed;scopeOverlay.style.display=isZoomed?"block":"none";}};
document.getElementById("rifleBtn").onclick=()=>switchWeapon("Rifle");
document.getElementById("sniperBtn").onclick=()=>switchWeapon("Sniper");
document.getElementById("shotgunBtn").onclick=()=>switchWeapon("Shotgun");
function switchWeapon(w){currentWeapon=w;ammo=weapons[w].ammo;reserve=weapons[w].reserve;updateGunModel();updateHUD();}

/* ANIMATE */
let prevTime=performance.now();
function animate(){requestAnimationFrame(animate);const time=performance.now();const delta=(time-prevTime)/1000;if(!gameOver){fireCooldown=Math.max(0,fireCooldown-delta);camera.rotation.x+=(targetRotX-camera.rotation.x)*0.1;camera.rotation.y+=(targetRotY-camera.rotation.y)*0.1;if(move.forward)camera.position.add(new THREE.Vector3(0,0,-0.1).applyQuaternion(camera.quaternion));if(move.backward)camera.position.add(new THREE.Vector3(0,0,0.1).applyQuaternion(camera.quaternion));if(move.left)camera.position.add(new THREE.Vector3(-0.1,0,0).applyQuaternion(camera.quaternion));if(move.right)camera.position.add(new THREE.Vector3(0.1,0,0).applyQuaternion(camera.quaternion));gunGroup.position.copy(camera.position).add(new THREE.Vector3(0.3,-0.3,-0.8).applyQuaternion(camera.quaternion));gunGroup.quaternion.copy(camera.quaternion);}prevTime=time;renderer.render(scene,camera);}animate();
updateHUD();
</script>
</body>
</html>
